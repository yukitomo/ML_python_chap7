# Bulding Machine Learning Systems with Python
# 実践 機械学習

## 7章 回帰:レコメンド
- 最小二乗法による回帰(古典的手法)の復習
	- 高速に実行できる
	- 現実の多くの問題に対して効果的
	- 特徴量の数がサンプルデータの数より大きい場合正しく扱えない
- Numpy, scikit-learnによる実行
- より進んだ手法 (lasso、ridge、elastic nets) の紹介
	- 古典的手法でうまく扱えない問題(特徴量の数が多い場合など)に対して有効
- レコメンドについての基礎

###7.1 回帰を用いて物件価格を予測する
ボストンにある物件について、その価格を予測する問題を考える。

#### 目標
    入力 : エリアの指定
    出力 : その周辺にある家の値段の中央値 (median)

#### データセット
以下の情報がデータセットで与えられる。

- 犯罪発生率
- 人口統計に関する情報
	- 「先生一人あたりに対する生徒の数」など 
- 地理情報

#### データセットの読み込み
scikit-learnに組み込まれているため以下のようにデータを読み込める。
サンプル数：506

```python
from sklearn.datasets import load_boston
boston = load_boston()
```

`boston` オブジェクトは属性 (attribute) をいくつか持ち 、主に以下を用いる
- `boston.data` : (X) 特徴量がいろいろ入っている 
- `boston.target` : (Y) ラベル、各エリアの家の値段の中央値 (今回の問題の目標変数 : target variable) 
     
`boston. DESCR`, `boston.feature_names` でデータセットの詳細が確認できる。

#### 特徴量が一次元の回帰
各エリアにおける 1 軒あたりの部屋数の平均値だけを用いて、家の値段を予測したい。
特徴量の部屋数の平均値は配列のインデックスが 5 の場所に格納されている。

`boston.data[:,5]` : 各エリアにおける 1 軒あたりの部屋数の平均値の系列

以下で、各エリアにおける 1 軒あたりの部屋数の平均値に対してのその周辺にある家の値段の中央値をプロットできる。

```python
from matplotlib import pyplot as plt
plt.scatter(boston.data[:,5], boston.target, color='r’)
plt.show()
```

上記の問題に対して、標準的な最小二乗法による回帰を用いることできる。Numpy のnp.linalg サブモジュールから基本的な 線形代数の基本的な演算を行う関数を使う。今回は特徴量が１次元なので、`y = cx`の傾き`c`を求めればよい。

```python
import numpy as np
x = boston.data[:,5]
x = np.array([[v] for v in x]) #xを二次元配列に書き換える
```

xを二次元配列にすることで、一つ目の次元には、異なるサンプルデータを、二つ目の次元には特徴量の要素を格納できる。今回は特徴量が１つなので 二つ目の次元の大きさは１になる。
`x = array( [ 6.575,  6.421,  7.185,…] )`
↓
`x = array( [ [6.575], [6.421], [7.185],... ] )`

```
y = boston.target
slope,total_error ,_,_ = np.linalg.lstsq(x,y)
rmse = np.sqrt(total_error[0]/len(x)) #平均二乗平方根誤差(root mean squared error:RMSE)
```
回帰直線の傾きを得るために、最小二乗法による回帰を行う。
np.linalg.lstsq 関数は、回帰がどれだけデータにあてはまるかということに関する以下の情報などをいくつか返す。`y` を「家の値段」、`x` を「部屋の数」として、`y = cx` という直線で近似することを意味する(最小二乗法により傾きcを求める)。
- `slope` : 近似直線の傾き
- `total_error` : 二乗誤差の総和

今回は、slope に傾きが格納され、傾きをとcして y = cx をグラフにプロットすると以下のようになる。


![図7−1](img/figure1.png)

上記のグラフから、特徴量の要素が一つだけのモデルを用いると、以下のことがわかる。
- 全然うまくいかない
- 「家の値段」が 「部屋の数」の倍数になってしまい明らかに誤り

#### バイアス項の追加























